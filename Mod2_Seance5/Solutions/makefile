# --------------------------------------------------------------------- #
#              Makefile du projet Mutex-Semaphore                       #
#                                                                       #
# C. VERCAUTER                                           10/04/2019     #
#                                                                       #
# --------------------------------------------------------------------- #


# --------------------------------------------------------------------- #
# Récupération du nom complet de l'utilisateur                          #
# --------------------------------------------------------------------- #
NAME := $(shell getent passwd $(shell whoami) | cut -d ':' -f 5 | tr ' ' '_')

# --------------------------------------------------------------------- #
# Spécification du compilateur utilisé                                  #
# --------------------------------------------------------------------- #
CC = gcc

# --------------------------------------------------------------------- #
# Définition des options du préprocesseur C                             #
#   -D_POSIX_C_SOURCE=200809L : conformité à la norme POSIX.1-2008      #
# --------------------------------------------------------------------- #
CPPFLAGS = -D_POSIX_C_SOURCE=200809L

# --------------------------------------------------------------------- #
# Définition des options de compilation                                 #
#                                                                       #
#   -Wall           : affiche lesprincipaux messages d'avertissement    #
#   -Wextra         : affichage de messages d'avertissement supplém.    #
#   -Werror         : traiter les avertissements comme des erreurs	#
#   -std=c99        : respect  du standard ISO C99                      #
#   -pedantic       : rien que le standard ISO C99                      #
# --------------------------------------------------------------------- #
CFLAGS  = -Wall 
#CFLAGS += -Wextra
CFLAGS += -std=c99 
CFLAGS += -pedantic
CFLAGS += -Werror

# --------------------------------------------------------------------- #
# Définition des librairies utilisées par l'éditeur de liens            #
# --------------------------------------------------------------------- #
LOADLIBES = -lpthread

# --------------------------------------------------------------------- #
#      Définition de la liste de fichiers sources                       #
# --------------------------------------------------------------------- #
SRC = $(wildcard *.c)

# --------------------------------------------------------------------- #
#      Construction des listes de fichiers objet                        #
# --------------------------------------------------------------------- #
OBJ = $(SRC:.c=.o)

# --------------------------------------------------------------------- #
#      Définition des cibles (exécutables)  à générer		        #
# --------------------------------------------------------------------- #
EXE        = $(SRC:.c=)

# --------------------------------------------------------------------- #
#      Définition de l'archive compressée  à générer		        #
# --------------------------------------------------------------------- #
AR	= "$(NAME).tar.gz"

# --------------------------------------------------------------------- #
#      Toutes les cibles                                                #
# --------------------------------------------------------------------- #
all: $(EXE)

# --------------------------------------------------------------------- #
#      Règles de dépendances implicites                                 #
# --------------------------------------------------------------------- #



# --------------------------------------------------------------------- #
#      Cibles spécifiques                                               #
# --------------------------------------------------------------------- #
.PHONY: clean realclean touchAll pretty depend targz

# --------------------------------------------------------------------- #
#       Cible secondaire : nettoyage des fichiers objets                #
# --------------------------------------------------------------------- #
clean:
	@rm -f $(OBJ) *.orig *~ *.bak
	@echo "Effacement des fichiers intermédiaires ...  effectué"

# --------------------------------------------------------------------- #
#      3 ème cible : nettoyage de tous les fichiers objets, des         #
#               fichiers exécutables et de l'archive                    #
# --------------------------------------------------------------------- #
realclean: clean
	@rm -f $(EXE)  $(AR)
	@echo "Nettoyage complet ... effectué"

# --------------------------------------------------------------------- #
#      4 ème cible :                                                    #
# --------------------------------------------------------------------- #
touchAll:
	@touch $(SRC)
# --------------------------------------------------------------------- #
#      5 ème cible :                                                    #
# --------------------------------------------------------------------- #
depend:
	$(CC)  -MM  $(SRC) 
# --------------------------------------------------------------------- #
#      6 ème cible :                                                    #
# --------------------------------------------------------------------- #
pretty:
	@astyle $(SRC) -q -A4
# --------------------------------------------------------------------- #
#      7 ème cible :                                                    #
# --------------------------------------------------------------------- #
targz: 	pretty realclean
	@tar czf "$(AR)" $(SRC) makefile
# --------------------------------------------------------------------- #

